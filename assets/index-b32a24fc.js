var u=Object.defineProperty;var p=(r,t,e)=>t in r?u(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var n=(r,t,e)=>(p(r,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();const g="https://inputtools.google.com/request?ime=handwriting&app=autodraw&dbg=1&cs=1&oe=UTF-8",c="https://storage.googleapis.com/artlab-public.appspot.com/stencils/selman/",v=r=>{const t=/SCORESINKS: (.*) Service_Recognize:/;return console.log("Resolve data |>",r),JSON.parse(r[1][0][3].debug_info.match(t)[1])},f=async r=>{try{console.log("Shapes |>",JSON.stringify(r));const e=await(await fetch(g,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({input_type:0,requests:[{language:"autodraw",writing_guide:{width:400,height:400},ink:r}]})})).json();if(e[0]!=="SUCCESS")throw new Error(e);return v(e).map(s=>{const o=s[0].replace(/ /g,"-");return{name:s[0],confidence:s[1],url:`${c}${o}-01.svg`,url_variant_1:`${c}${o}-02.svg`,url_variant_2:`${c}${o}-03.svg`}})}catch(t){console.log(t)}};class m{constructor(t){n(this,"pressed");n(this,"pressedAt");n(this,"drawingInterval");n(this,"intervalLastPosition");n(this,"shapes");n(this,"currentShape");n(this,"prevX");n(this,"currX");n(this,"prevY");n(this,"currY");n(this,"dColor");n(this,"dColorStartingPoint");n(this,"dStroke");n(this,"highlightStartPoint");n(this,"canvas");n(this,"ctx");n(this,"resolvedImages");n(this,"displaySuggestionsFunction");this.pressed=!1,this.pressedAt=0,this.drawingInterval=null,this.intervalLastPosition=[-1,-1],this.shapes=[],this.currentShape=[[],[],[]],this.prevX=0,this.currX=0,this.prevY=0,this.currY=0,this.highlightStartPoint=!1,this.dColor="black",this.dColorStartingPoint="black",this.dStroke=8,this.resolvedImages=void 0,this.displaySuggestionsFunction=t,this.canvas=document.getElementById("canvas"),this.ctx=this.canvas.getContext("2d")}init(){var t,e,a,i;(t=this.canvas)==null||t.addEventListener("mousemove",s=>{this.drawXY("move",s)},!1),(e=this.canvas)==null||e.addEventListener("mousedown",s=>{this.drawXY("down",s)},!1),(a=this.canvas)==null||a.addEventListener("mouseup",s=>{this.drawXY("up",s)},!1),(i=this.canvas)==null||i.addEventListener("mouseout",s=>{this.drawXY("out",s)},!1)}prepareNewShape(){this.currentShape=[[],[],[]]}drawXY(t,e){!this.canvas||!this.ctx||(t=="down"&&(this.prevX=this.currX,this.prevY=this.currY,this.currX=e.clientX-this.canvas.offsetLeft,this.currY=e.clientY-this.canvas.offsetTop,this.pressed=!0,this.pressedAt=Date.now(),this.highlightStartPoint=!0,this.prepareNewShape(),this.drawingInterval=setInterval(this.drawingShape.bind(this),9),this.highlightStartPoint&&(this.ctx.beginPath(),this.ctx.fillStyle=this.dColorStartingPoint,this.ctx.fillRect(this.currX,this.currY,2,2),this.ctx.closePath(),this.highlightStartPoint=!1)),(t=="up"||this.pressed&&t=="out")&&(this.pressed=!1,this.commitCurrentShape()),t=="move"&&this.pressed&&(this.prevX=this.currX,this.prevY=this.currY,this.currX=e.clientX-this.canvas.offsetLeft,this.currY=e.clientY-this.canvas.offsetTop,this.draw()))}addPointToCurrentShape(t,e){this.currentShape||(this.currentShape=[[],[],[]]),this.currentShape[0].push(t),this.currentShape[1].push(e),this.currentShape[2].push(Date.now()-this.pressedAt)}drawingShape(){this.intervalLastPosition[0]==this.prevX&&this.intervalLastPosition[1]==this.prevY||(this.addPointToCurrentShape(this.prevX,this.prevY),this.intervalLastPosition=[this.prevX,this.prevY])}draw(){!this.canvas||!this.ctx||(this.ctx.beginPath(),this.ctx.moveTo(this.prevX,this.prevY),this.ctx.lineTo(this.currX,this.currY),this.ctx.strokeStyle=this.dColor,this.ctx.fillStyle=this.dColor,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.lineWidth=this.dStroke,this.ctx.stroke(),this.ctx.closePath())}async commitCurrentShape(){clearInterval(this.drawingInterval),this.shapes.push(this.currentShape),this.resolvedImages=await f(this.shapes),this.displaySuggestionsFunction(this.resolvedImages)}erase(){var t,e;!this.canvas||!this.ctx||(this.ctx.clearRect(0,0,(t=this.canvas)==null?void 0:t.width,(e=this.canvas)==null?void 0:e.height),document.getElementById("canval").value="",this.shapes=[])}save(){if(!this.canvas)return;const t=this.canvas.toDataURL();document.getElementById("canval").value=t}}function S(r){if(!r)return;const t=document.getElementById("suggestions");t.innerHTML="";for(let e=0;e<r.length;e++){const a=r[e],i=document.createElement("img");i.setAttribute("src",a.url),i.setAttribute("width","80"),i.setAttribute("height","80"),i.style.border="1px solid black",i.onerror=function(){this.remove()};const s=document.createElement("div");s.setAttribute("style","width:80px;height:80px;"),s.appendChild(i),t.appendChild(s)}}const h=new m(S);h.init();document.addEventListener("click",function(r){var e,a;const t=r.target;(t==null?void 0:t.tagName)==="IMG"&&((a=(e=t.parentElement)==null?void 0:e.parentElement)==null?void 0:a.id)==="suggestions"&&w(t.getAttribute("src"))});function w(r){if(!r)return;h.erase();const t=new Image;t.onload=()=>{var e;(e=h.ctx)==null||e.drawImage(t,0,0)},t.src=r}var l;(l=document.querySelector("#save"))==null||l.addEventListener("click",()=>h.save());var d;(d=document.querySelector("#clear"))==null||d.addEventListener("click",()=>h.erase());
